const MEDIA={xSmall:"(max-width: 479px)",small:"(max-width: 783px)",medium:"(max-width: 1001px)",large:"(max-width: 1233px)",xLarge:"(max-width: 1439px)",xxLarge:"(min-width: 1440px)"},pictureSources=new Map([["xSmall","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_ar_1_1,c_fill,g_auto__c_scale,w_450.jpg"],["small","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_c_scale,w_480.jpg"],["medium","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_c_scale,w_784.jpg"],["large","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_c_scale,w_1002.jpg"],["xLarge","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_c_scale,w_1234.jpg"],["xxLarge","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_c_scale,w_1400.jpg"],["default","./images/sean-o-KMn4VEeEPR8-unsplash_1_s6zmfh_ar_1_1,c_fill,g_auto__c_scale,w_450.jpg"]]),app=document.querySelector("#app");class Popup{constructor(e,t,n,s){this.parentElement=e,this.counter=t,this.resetButtonVisible=n,this.currentSection=s,this.popupWrapper=document.createElement("div"),this.popupWindow=document.createElement("div"),this.popupCloseButton=document.createElement("button"),this.popupContent=document.createElement("p"),this.resetButton=null,this.data=null,this.createPopup()}createPopup(){this.popupWrapper.classList.add("popup"),this.parentElement.prepend(this.popupWrapper),this.popupWrapper.addEventListener("click",e=>this.onClosePopup(e)),this.popupWindow.classList.add("popup__window"),this.popupWrapper.append(this.popupWindow);const e=document.createElement("h1"),t=(e.classList.add("popup__window__title"),e.innerText="Alert!",this.popupContent.classList.add("popup__window__content"),this.createContentText(this.popupContent,this.counter),this.popupCloseButton.classList.add("popup__window__close"),this.popupCloseButton.setAttribute("aria-label","Close pop-up"),this.popupCloseButton.title="Close pop-up",this.popupWindow.append(e,this.popupContent,this.popupCloseButton),this.resetButtonVisible||this.popupCloseButton.focus(),document.createElement("span")),n=(t.classList.add("popup__window__close__left"),document.createElement("span"));n.classList.add("popup__window__close__right"),this.popupCloseButton.append(t,n),this.resetButtonVisible&&this.createResetButton(),new DataTable(this.popupWindow,"https://jsonplaceholder.typicode.com/users")}onClosePopup(e){e.target!==this.popupWrapper&&e.target!==this.popupCloseButton&&e.target!==this.popupCloseButton.childNodes[0]&&e.target!==this.popupCloseButton.childNodes[1]||(this.popupWrapper.remove(),this.currentSection.onButtonsDisabled(!1),app.parentElement.style.overflow="visible")}onResetCounter(){this.popupContent.textContent="The counter has beend reset.",this.currentSection.onCounterUpdate(0),this.resetButton.remove()}createResetButton(){this.resetButton=document.createElement("button"),this.resetButton.classList.add("popup__window__reset"),this.resetButton.innerText="Reset Counter",this.resetButton.setAttribute("aria-label","Reset counter"),this.resetButton.title="Reset counter",this.popupWindow.append(this.resetButton),this.resetButton.focus(),this.resetButton.addEventListener("click",()=>{this.onResetCounter()})}createContentText(e,t){const n=document.createElement("strong");e.append(n);var s=document.createTextNode("You have clicked"),t=document.createTextNode(` ${t} times `),a=document.createTextNode("to related button.");e.prepend(s),n.append(t),e.append(a)}}class Picture{constructor(e,t,n,s){this.parentElement=e,this.pictureSources=t,this.media=n,this.altText=s,this.imageWrapper=document.createElement("picture"),this.createPicture()}createPicture(){this.imageWrapper.classList.add("container__image"),this.parentElement.append(this.imageWrapper),this.createPictureSource(this.pictureSources,this.media);const e=document.createElement("img");e.classList.add("container__image__picture"),e.src=this.pictureSources.get("default"),e.alt=this.altText,e.title=this.altText,this.imageWrapper.append(e)}createPictureSource(e,t){if(e.size)for(var[n,s]of e.entries()){const a=document.createElement("source");a.media=t[n],a.srcset=s,this.imageWrapper.append(a)}}}class Section{constructor(e,t){this.counter=localStorage.getItem("Section-"+t)??0,this.name=t,this.parentElement=e,this.resetButtonVisible=!1,this.section=document.createElement("section"),this.button=document.createElement("button"),this.createSection()}createSection(){this.section.classList.add("container"),this.parentElement.append(this.section),new Picture(this.section,pictureSources,MEDIA,"Ocean");const e=document.createElement("article"),t=(e.classList.add("container__content"),this.section.append(e),document.createElement("h1")),n=(t.classList.add("container__content__title"),t.innerText="Lorem Ipsum",document.createElement("p"));n.classList.add("container__content__paragraph"),n.innerText="Infinitely scalable, feature-rich and cloud-native data management and protection for modern and legacy infrastructures and SaaS platforms, managed via a single app with no hardware required.",this.button.classList.add("container__content__button"),this.button.type="button",this.button.innerText="Button",this.button.title="Open pop-up and increase counter",this.button.setAttribute("aria-label","Click me to increase counter"),e.append(t,n,this.button),this.button.addEventListener("click",()=>this.onOpenPopup())}onCounterUpdate(e){if(0!==(this.counter=e))return localStorage.setItem("Section-"+this.name,e);localStorage.removeItem("Section-"+this.name)}onButtonsDisabled(t){const e=document.querySelectorAll(".container button");e.forEach(e=>e.disabled=t)}onOpenPopup(){++this.counter,localStorage.setItem("Section-"+this.name,this.counter),this.resetButtonVisible=5<this.counter,app.parentElement.style.overflow="hidden",this.onButtonsDisabled(!0),new Popup(this.parentElement,this.counter,this.resetButtonVisible,this)}}async function fetchData(e){const t=new AbortController;var n=()=>setTimeout(()=>t.abort(),5e3);n();try{const s=await fetch(e,{headers:{"Content-Type":"application/json"},signal:t.signal});if(s.ok)return await s.json();throw new Error(s.statusText)}catch(e){return"AbortError"===e.name?new Error(e.message):e}finally{clearTimeout(n)}}new Section(app,"first"),new Section(app,"second");class DataTable{constructor(e,t){this.parentElement=e,this.table=document.createElement("table"),this.loader=document.createElement("div"),this.url=t,this.data=[],this.isLoading=!0,this.createTable()}createTable(){this.table.classList.add("table"),this.parentElement.append(this.table),this.isLoading&&(this.loader.classList.add("table__loader"),this.table.append(this.loader)),this.isLoading||this.loader.remove(),this.setData()}drawTableBody(e){const t=document.createElement("thead"),n=document.createElement("tr"),s=(t.append(n),document.createElement("th")),a=(s.innerText="Name",document.createElement("th")),o=(a.innerText="Email",document.createElement("th")),i=(o.innerText="Address",document.createElement("th")),r=(i.innerText="Phone",document.createElement("th")),u=(r.innerText="Company",n.append(s,a,o,i,r),document.createElement("tbody"));e.forEach(e=>{const t=document.createElement("tr"),n=document.createElement("td"),s=(n.innerText=e.name,document.createElement("td")),a=(s.innerText=e.email,document.createElement("td")),o=document.createElement("span"),i=(o.innerText=e.address.city,document.createElement("span")),r=(i.innerText=e.address.street,document.createElement("span")),p=(r.innerText=e.address.suite,a.append(o,i,r),document.createElement("td")),c=(p.innerText=e.phone,document.createElement("td"));c.innerText=e.company.name,u.append(t),t.append(n,s,a,p,c)}),this.table.append(t,u)}async setData(){this.isLoading=!0;var e=await fetchData(this.url);if(e instanceof Error)return this.isLoading=!1,this.loader.remove(),this.showErrorInfo(e);this.drawTableBody(e),this.loader.remove(),this.isLoading=!1}showErrorInfo(e){const t=document.createElement("div"),n=(t.classList.add("error"),this.table.append(t),document.createElement("h2")),s=(n.classList.add("error__title"),n.innerText=e.name,document.createElement("p"));s.classList.add("error__message"),s.innerText=e.message,t.append(n,s)}}